<UserControl x:Class="SLICE_System.Views.UsersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#FDFBF7" FontFamily="Segoe UI">

    <UserControl.Resources>
        <SolidColorBrush x:Key="BrandBlue" Color="#3498DB"/>
        <SolidColorBrush x:Key="BrandRed" Color="#C0392B"/>
        <SolidColorBrush x:Key="BrandGreen" Color="#27AE60"/>
        <SolidColorBrush x:Key="TextDark" Color="#2C3E50"/>
        <SolidColorBrush x:Key="TextLight" Color="#95A5A6"/>

        <Geometry x:Key="Vec_Search">M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z</Geometry>
        <Geometry x:Key="Vec_Plus">M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z</Geometry>
        <Geometry x:Key="Vec_Trash">M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M9,8H11V17H9V8M13,8H15V17H13V8Z</Geometry>
        <Geometry x:Key="Vec_Restore">M13,3A9,9 0 0,0 4,12H1L4.89,15.89L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3Z</Geometry>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="15" Color="#BDC3C7" ShadowDepth="3" Opacity="0.2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource BrandBlue}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="User Administration" FontSize="28" FontWeight="Black" Foreground="{StaticResource TextDark}"/>
                <TextBlock Text="Manage system access and permissions." FontSize="14" Foreground="{StaticResource TextLight}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Border Background="White" CornerRadius="20" Height="40" Width="250" Margin="0,0,15,0">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" Color="#BDC3C7" ShadowDepth="2" Opacity="0.1"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Path Data="{StaticResource Vec_Search}" Fill="{StaticResource TextLight}" Height="14" Width="14" Stretch="Uniform" HorizontalAlignment="Center"/>
                        <TextBox x:Name="txtSearch" Grid.Column="1" BorderThickness="0" Background="Transparent" 
                                 VerticalContentAlignment="Center" FontSize="14" Foreground="{StaticResource TextDark}"
                                 TextChanged="txtSearch_TextChanged"/>
                        <TextBlock Grid.Column="1" Text="Find user..." Foreground="#BDC3C7" VerticalAlignment="Center" IsHitTestVisible="False" Margin="2,0,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Text, ElementName=txtSearch}" Value="">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </Border>

                <Button Click="AddUser_Click" Style="{StaticResource ActionButtonStyle}">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource Vec_Plus}" Fill="White" Height="12" Width="12" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="NEW USER"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <Border Grid.Row="1" Style="{StaticResource CardStyle}">
            <DataGrid x:Name="dgUsers" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True"
                      GridLinesVisibility="Horizontal" HeadersVisibility="Column" Background="Transparent" BorderThickness="0"
                      RowHeight="55" VerticalScrollBarVisibility="Auto" Margin="10">

                <DataGrid.Resources>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="{StaticResource TextLight}"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Padding" Value="15,10"/>
                        <Setter Property="BorderThickness" Value="0,0,0,1"/>
                        <Setter Property="BorderBrush" Value="#EEE"/>
                    </Style>
                    <Style TargetType="DataGridCell">
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="10,0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridCell">
                                    <Border Background="{TemplateBinding Background}">
                                        <ContentPresenter VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#F0F8FF"/>
                                <Setter Property="Foreground" Value="{StaticResource TextDark}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.Resources>

                <DataGrid.Columns>
                    <DataGridTemplateColumn Width="70">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Width="35" Height="35" CornerRadius="17" Background="#ECF0F1">
                                    <TextBlock Text="{Binding Initials}" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                               FontWeight="Bold" Foreground="{StaticResource TextLight}"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="NAME" Width="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{Binding FullName}" FontWeight="SemiBold" Foreground="{StaticResource TextDark}"/>
                                    <TextBlock Text="{Binding Username}" FontSize="11" Foreground="{StaticResource TextLight}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="ROLE" Width="140">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="4" Padding="8,4" HorizontalAlignment="Left" Background="White" BorderThickness="1" BorderBrush="{Binding RoleColor}">
                                    <TextBlock Text="{Binding Role}" Foreground="{Binding RoleColor}" FontSize="11" FontWeight="Bold"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="BRANCH ASSIGNMENT" Binding="{Binding BranchName}" Width="*" Foreground="{StaticResource TextDark}"/>

                    <DataGridTemplateColumn Header="STATUS" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Ellipse Width="8" Height="8" Fill="{Binding StatusColor}" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding StatusText}" Foreground="{Binding StatusColor}" FontSize="12"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Width="70" Header="ACTION">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Button Click="DeleteUser_Click" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Deactivate User" Tag="{Binding UserID}">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                        <Path Data="{StaticResource Vec_Trash}" Fill="{StaticResource BrandRed}" Height="14" Width="14" Stretch="Uniform" Opacity="0.7"/>
                                    </Button>

                                    <Button Click="RestoreUser_Click" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Restore User" Tag="{Binding UserID}">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsActive}" Value="False">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                        <Path Data="{StaticResource Vec_Restore}" Fill="{StaticResource BrandGreen}" Height="14" Width="14" Stretch="Uniform"/>
                                    </Button>
                                </Grid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>