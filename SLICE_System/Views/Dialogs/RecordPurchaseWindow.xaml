<Window x:Class="SLICE_System.Views.Dialogs.RecordPurchaseWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Record Stock Purchase" Height="600" Width="800"
        WindowStartupLocation="CenterScreen" Background="#FDFBF7">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="White" Padding="15" CornerRadius="8" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,20,0">
                    <TextBlock Text="SUPPLIER NAME" FontSize="11" FontWeight="Bold" Foreground="#95A5A6"/>
                    <TextBox Text="{Binding SupplierName}" Height="35" VerticalContentAlignment="Center" FontSize="14" FontWeight="SemiBold"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="0,0,20,0">
                    <TextBlock Text="RECEIVING BRANCH" FontSize="11" FontWeight="Bold" Foreground="#95A5A6"/>
                    <ComboBox ItemsSource="{Binding Branches}" SelectedItem="{Binding SelectedBranch}" 
                              DisplayMemberPath="BranchName" Height="35"/>
                </StackPanel>

                <StackPanel Grid.Column="2">
                    <TextBlock Text="DATE" FontSize="11" FontWeight="Bold" Foreground="#95A5A6"/>
                    <DatePicker SelectedDate="{Binding PurchaseDate}" Height="35" Width="120"/>
                </StackPanel>
            </Grid>
        </Border>

        <DataGrid Grid.Row="1" ItemsSource="{Binding CartItems}" AutoGenerateColumns="False" CanUserAddRows="False"
                  Background="White" BorderBrush="#DDD" RowHeight="40" Margin="0,0,0,15">
            <DataGrid.Columns>

                <DataGridTemplateColumn Header="INGREDIENT" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding DataContext.AllIngredients, RelativeSource={RelativeSource AncestorType=Window}}"
                                      SelectedValue="{Binding ItemID, UpdateSourceTrigger=PropertyChanged}"
                                      SelectedValuePath="ItemID"
                                      DisplayMemberPath="ItemName"
                                      BorderThickness="0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="QUANTITY" Binding="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}" Width="100"/>

                <DataGridTextColumn Header="UNIT COST (₱)" Binding="{Binding UnitPrice, UpdateSourceTrigger=PropertyChanged, StringFormat=N2}" Width="120"/>

                <DataGridTextColumn Header="SUBTOTAL" Binding="{Binding Subtotal, StringFormat=N2, Mode=OneWay}" Width="120" IsReadOnly="True" FontWeight="Bold"/>

                <DataGridTemplateColumn Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="X" Command="{Binding DataContext.RemoveRowCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                    CommandParameter="{Binding}" Background="#E74C3C" Foreground="White" BorderThickness="0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Command="{Binding AddRowCommand}" Content="+ Add Line Item" 
                    Background="Transparent" Foreground="#2980B9" BorderThickness="0" Cursor="Hand"/>

            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <TextBlock Text="TOTAL:" FontSize="18" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#7F8C8D"/>
                <TextBlock Text="{Binding GrandTotal, StringFormat=₱ {0:N2}}" FontSize="24" FontWeight="Bold" Foreground="#2C3E50" Margin="0,0,20,0"/>

                <Button Command="{Binding SaveCommand}" Content="CONFIRM PURCHASE" 
                        Background="#27AE60" Foreground="White" FontWeight="Bold" Width="180" Height="45">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="6"/>
                        </Style>
                    </Button.Resources>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Window>